#!/bin/sh

VENV_PATH=".venv"

# Run linter
echo "Running ruff linter..."
$VENV_PATH/bin/ruff check . --fix

#if ruff fails, exit
if [ $? -ne 0 ]; then
    echo "Ruff linter failed. Aborting commit."
    exit 1
fi

# Check if there are tests to run (excluding E2E tests)
if [ -d "tests" ]; then
    echo "Running unit tests (excluding E2E)..."
    if [ -d "$VENV_PATH" ]; then
        $VENV_PATH/bin/python -m pytest tests/ --ignore=tests/e2e || {
            echo "Tests failed. Aborting commit."
            exit 1
        }
    else
        # Fallback to using the system python
        python -m pytest tests/ --ignore=tests/e2e || {
            echo "Tests failed. Aborting commit."
            exit 1
        }
    fi

    echo "All tests passed!"
else
    echo "No tests directory found. Skipping tests."
fi
