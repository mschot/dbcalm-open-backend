============================= test session starts ==============================
platform linux -- Python 3.11.14, pytest-8.4.2, pluggy-1.6.0 -- /usr/bin/python3.11
cachedir: .pytest_cache
rootdir: /app
configfile: pyproject.toml
collecting ... collected 10 items

test_backup_restore.py::TestFullBackupRestore::test_full_backup_creation PASSED [ 10%]
test_backup_restore.py::TestFullBackupRestore::test_full_restore PASSED  [ 20%]
test_backup_restore.py::TestFullBackupRestore::test_full_restore ERROR   [ 20%]
test_backup_restore.py::TestIncrementalBackupRestore::test_incremental_backup_creation PASSED [ 30%]
test_backup_restore.py::TestIncrementalBackupRestore::test_incremental_restore PASSED [ 40%]
test_backup_restore.py::TestIncrementalBackupRestore::test_incremental_restore ERROR [ 40%]
test_backup_restore.py::TestCredentialsValidation::test_backup_requires_credentials_file PASSED [ 50%]
test_backup_restore.py::TestCredentialsValidation::test_backup_requires_client_dbcalm_section PASSED [ 60%]
test_backup_restore.py::TestRestorePreconditions::test_restore_requires_server_stopped PASSED [ 70%]
test_backup_restore.py::TestRestorePreconditions::test_restore_requires_empty_data_directory PASSED [ 80%]
test_backup_restore.py::TestRestorePreconditions::test_restore_requires_empty_data_directory ERROR [ 80%]
test_backup_restore.py::TestBackupListing::test_list_backups PASSED      [ 90%]
test_backup_restore.py::TestBackupListing::test_get_backup_details PASSED [100%]

==================================== ERRORS ====================================
_________ ERROR at teardown of TestFullBackupRestore.test_full_restore _________
  + Exception Group Traceback (most recent call last):
  |   File "/usr/local/lib/python3.11/dist-packages/_pytest/runner.py", line 344, in from_call
  |     result: TResult | None = func()
  |                              ^^^^^^
  |   File "/usr/local/lib/python3.11/dist-packages/_pytest/runner.py", line 246, in <lambda>
  |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/usr/local/lib/python3.11/dist-packages/pluggy/_hooks.py", line 512, in __call__
  |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/usr/local/lib/python3.11/dist-packages/pluggy/_manager.py", line 120, in _hookexec
  |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/usr/local/lib/python3.11/dist-packages/pluggy/_callers.py", line 167, in _multicall
  |     raise exception
  |   File "/usr/local/lib/python3.11/dist-packages/pluggy/_callers.py", line 139, in _multicall
  |     teardown.throw(exception)
  |   File "/usr/local/lib/python3.11/dist-packages/_pytest/logging.py", line 858, in pytest_runtest_teardown
  |     yield
  |   File "/usr/local/lib/python3.11/dist-packages/pluggy/_callers.py", line 139, in _multicall
  |     teardown.throw(exception)
  |   File "/usr/local/lib/python3.11/dist-packages/_pytest/capture.py", line 905, in pytest_runtest_teardown
  |     return (yield)
  |             ^^^^^
  |   File "/usr/local/lib/python3.11/dist-packages/pluggy/_callers.py", line 121, in _multicall
  |     res = hook_impl.function(*args)
  |           ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/usr/local/lib/python3.11/dist-packages/_pytest/runner.py", line 193, in pytest_runtest_teardown
  |     item.session._setupstate.teardown_exact(nextitem)
  |   File "/usr/local/lib/python3.11/dist-packages/_pytest/runner.py", line 557, in teardown_exact
  |     raise exceptions[0]
  | ExceptionGroup: errors while tearing down <Function test_full_restore> (2 sub-exceptions)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/usr/local/lib/python3.11/dist-packages/_pytest/runner.py", line 546, in teardown_exact
    |     fin()
    |   File "/usr/local/lib/python3.11/dist-packages/_pytest/fixtures.py", line 1069, in finish
    |     raise exceptions[0]
    |   File "/usr/local/lib/python3.11/dist-packages/_pytest/fixtures.py", line 1058, in finish
    |     fin()
    |   File "/usr/local/lib/python3.11/dist-packages/_pytest/fixtures.py", line 939, in _teardown_yield_fixture
    |     next(it)
    |   File "/app/tests/e2e/conftest.py", line 99, in db_connection
    |     connection.close()
    |   File "/usr/local/lib/python3.11/dist-packages/pymysql/connections.py", line 424, in close
    |     raise err.Error("Already closed")
    | pymysql.err.Error: Already closed
    +---------------- 2 ----------------
    | Traceback (most recent call last):
    |   File "/usr/local/lib/python3.11/dist-packages/_pytest/runner.py", line 546, in teardown_exact
    |     fin()
    |   File "/usr/local/lib/python3.11/dist-packages/_pytest/fixtures.py", line 1069, in finish
    |     raise exceptions[0]
    |   File "/usr/local/lib/python3.11/dist-packages/_pytest/fixtures.py", line 1058, in finish
    |     fin()
    |   File "/usr/local/lib/python3.11/dist-packages/_pytest/fixtures.py", line 939, in _teardown_yield_fixture
    |     next(it)
    |   File "/app/tests/e2e/conftest.py", line 133, in ensure_clean_state
    |     cursor.execute("SET FOREIGN_KEY_CHECKS = 0")
    |   File "/usr/local/lib/python3.11/dist-packages/pymysql/cursors.py", line 153, in execute
    |     result = self._query(query)
    |              ^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/dist-packages/pymysql/cursors.py", line 322, in _query
    |     conn.query(q)
    |   File "/usr/local/lib/python3.11/dist-packages/pymysql/connections.py", line 574, in query
    |     self._execute_command(COMMAND.COM_QUERY, sql)
    |   File "/usr/local/lib/python3.11/dist-packages/pymysql/connections.py", line 844, in _execute_command
    |     raise err.InterfaceError(0, "")
    | pymysql.err.InterfaceError: (0, '')
    +------------------------------------
----------------------------- Captured stdout call -----------------------------
DEBUG: Restore status check - Full response: {'status': 'running', 'link': '/status/b46ebe1e-4654-40e0-8f5d-1d4cf3fd3eae', 'pid': None, 'resource_id': None}
DEBUG: Status value: running
DEBUG: Restore status check - Full response: {'status': 'success', 'link': '/status/b46ebe1e-4654-40e0-8f5d-1d4cf3fd3eae', 'pid': None, 'resource_id': None}
DEBUG: Status value: success
DEBUG: Restore succeeded! Final status: {'status': 'success', 'link': '/status/b46ebe1e-4654-40e0-8f5d-1d4cf3fd3eae', 'pid': None, 'resource_id': None}
__ ERROR at teardown of TestIncrementalBackupRestore.test_incremental_restore __
  + Exception Group Traceback (most recent call last):
  |   File "/usr/local/lib/python3.11/dist-packages/_pytest/runner.py", line 344, in from_call
  |     result: TResult | None = func()
  |                              ^^^^^^
  |   File "/usr/local/lib/python3.11/dist-packages/_pytest/runner.py", line 246, in <lambda>
  |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/usr/local/lib/python3.11/dist-packages/pluggy/_hooks.py", line 512, in __call__
  |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/usr/local/lib/python3.11/dist-packages/pluggy/_manager.py", line 120, in _hookexec
  |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/usr/local/lib/python3.11/dist-packages/pluggy/_callers.py", line 167, in _multicall
  |     raise exception
  |   File "/usr/local/lib/python3.11/dist-packages/pluggy/_callers.py", line 139, in _multicall
  |     teardown.throw(exception)
  |   File "/usr/local/lib/python3.11/dist-packages/_pytest/logging.py", line 858, in pytest_runtest_teardown
  |     yield
  |   File "/usr/local/lib/python3.11/dist-packages/pluggy/_callers.py", line 139, in _multicall
  |     teardown.throw(exception)
  |   File "/usr/local/lib/python3.11/dist-packages/_pytest/capture.py", line 905, in pytest_runtest_teardown
  |     return (yield)
  |             ^^^^^
  |   File "/usr/local/lib/python3.11/dist-packages/pluggy/_callers.py", line 121, in _multicall
  |     res = hook_impl.function(*args)
  |           ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/usr/local/lib/python3.11/dist-packages/_pytest/runner.py", line 193, in pytest_runtest_teardown
  |     item.session._setupstate.teardown_exact(nextitem)
  |   File "/usr/local/lib/python3.11/dist-packages/_pytest/runner.py", line 557, in teardown_exact
  |     raise exceptions[0]
  | ExceptionGroup: errors while tearing down <Function test_incremental_restore> (2 sub-exceptions)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/usr/local/lib/python3.11/dist-packages/_pytest/runner.py", line 546, in teardown_exact
    |     fin()
    |   File "/usr/local/lib/python3.11/dist-packages/_pytest/fixtures.py", line 1069, in finish
    |     raise exceptions[0]
    |   File "/usr/local/lib/python3.11/dist-packages/_pytest/fixtures.py", line 1058, in finish
    |     fin()
    |   File "/usr/local/lib/python3.11/dist-packages/_pytest/fixtures.py", line 939, in _teardown_yield_fixture
    |     next(it)
    |   File "/app/tests/e2e/conftest.py", line 99, in db_connection
    |     connection.close()
    |   File "/usr/local/lib/python3.11/dist-packages/pymysql/connections.py", line 424, in close
    |     raise err.Error("Already closed")
    | pymysql.err.Error: Already closed
    +---------------- 2 ----------------
    | Traceback (most recent call last):
    |   File "/usr/local/lib/python3.11/dist-packages/_pytest/runner.py", line 546, in teardown_exact
    |     fin()
    |   File "/usr/local/lib/python3.11/dist-packages/_pytest/fixtures.py", line 1069, in finish
    |     raise exceptions[0]
    |   File "/usr/local/lib/python3.11/dist-packages/_pytest/fixtures.py", line 1058, in finish
    |     fin()
    |   File "/usr/local/lib/python3.11/dist-packages/_pytest/fixtures.py", line 939, in _teardown_yield_fixture
    |     next(it)
    |   File "/app/tests/e2e/conftest.py", line 133, in ensure_clean_state
    |     cursor.execute("SET FOREIGN_KEY_CHECKS = 0")
    |   File "/usr/local/lib/python3.11/dist-packages/pymysql/cursors.py", line 153, in execute
    |     result = self._query(query)
    |              ^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/dist-packages/pymysql/cursors.py", line 322, in _query
    |     conn.query(q)
    |   File "/usr/local/lib/python3.11/dist-packages/pymysql/connections.py", line 574, in query
    |     self._execute_command(COMMAND.COM_QUERY, sql)
    |   File "/usr/local/lib/python3.11/dist-packages/pymysql/connections.py", line 844, in _execute_command
    |     raise err.InterfaceError(0, "")
    | pymysql.err.InterfaceError: (0, '')
    +------------------------------------
----------------------------- Captured stdout call -----------------------------
DEBUG: Restore status check - Full response: {'status': 'running', 'link': '/status/70fa7dfc-742b-496c-8b77-0927077d4b24', 'pid': None, 'resource_id': None}
DEBUG: Status value: running
DEBUG: Restore status check - Full response: {'status': 'success', 'link': '/status/70fa7dfc-742b-496c-8b77-0927077d4b24', 'pid': None, 'resource_id': None}
DEBUG: Status value: success
DEBUG: Restore succeeded! Final status: {'status': 'success', 'link': '/status/70fa7dfc-742b-496c-8b77-0927077d4b24', 'pid': None, 'resource_id': None}
_ ERROR at teardown of TestRestorePreconditions.test_restore_requires_empty_data_directory _
  + Exception Group Traceback (most recent call last):
  |   File "/usr/local/lib/python3.11/dist-packages/_pytest/runner.py", line 344, in from_call
  |     result: TResult | None = func()
  |                              ^^^^^^
  |   File "/usr/local/lib/python3.11/dist-packages/_pytest/runner.py", line 246, in <lambda>
  |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
  |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/usr/local/lib/python3.11/dist-packages/pluggy/_hooks.py", line 512, in __call__
  |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/usr/local/lib/python3.11/dist-packages/pluggy/_manager.py", line 120, in _hookexec
  |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/usr/local/lib/python3.11/dist-packages/pluggy/_callers.py", line 167, in _multicall
  |     raise exception
  |   File "/usr/local/lib/python3.11/dist-packages/pluggy/_callers.py", line 139, in _multicall
  |     teardown.throw(exception)
  |   File "/usr/local/lib/python3.11/dist-packages/_pytest/logging.py", line 858, in pytest_runtest_teardown
  |     yield
  |   File "/usr/local/lib/python3.11/dist-packages/pluggy/_callers.py", line 139, in _multicall
  |     teardown.throw(exception)
  |   File "/usr/local/lib/python3.11/dist-packages/_pytest/capture.py", line 905, in pytest_runtest_teardown
  |     return (yield)
  |             ^^^^^
  |   File "/usr/local/lib/python3.11/dist-packages/pluggy/_callers.py", line 121, in _multicall
  |     res = hook_impl.function(*args)
  |           ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/usr/local/lib/python3.11/dist-packages/_pytest/runner.py", line 193, in pytest_runtest_teardown
  |     item.session._setupstate.teardown_exact(nextitem)
  |   File "/usr/local/lib/python3.11/dist-packages/_pytest/runner.py", line 557, in teardown_exact
  |     raise exceptions[0]
  | ExceptionGroup: errors while tearing down <Function test_restore_requires_empty_data_directory> (2 sub-exceptions)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "/usr/local/lib/python3.11/dist-packages/_pytest/runner.py", line 546, in teardown_exact
    |     fin()
    |   File "/usr/local/lib/python3.11/dist-packages/_pytest/fixtures.py", line 1069, in finish
    |     raise exceptions[0]
    |   File "/usr/local/lib/python3.11/dist-packages/_pytest/fixtures.py", line 1058, in finish
    |     fin()
    |   File "/usr/local/lib/python3.11/dist-packages/_pytest/fixtures.py", line 939, in _teardown_yield_fixture
    |     next(it)
    |   File "/app/tests/e2e/conftest.py", line 99, in db_connection
    |     connection.close()
    |   File "/usr/local/lib/python3.11/dist-packages/pymysql/connections.py", line 424, in close
    |     raise err.Error("Already closed")
    | pymysql.err.Error: Already closed
    +---------------- 2 ----------------
    | Traceback (most recent call last):
    |   File "/usr/local/lib/python3.11/dist-packages/_pytest/runner.py", line 546, in teardown_exact
    |     fin()
    |   File "/usr/local/lib/python3.11/dist-packages/_pytest/fixtures.py", line 1069, in finish
    |     raise exceptions[0]
    |   File "/usr/local/lib/python3.11/dist-packages/_pytest/fixtures.py", line 1058, in finish
    |     fin()
    |   File "/usr/local/lib/python3.11/dist-packages/_pytest/fixtures.py", line 939, in _teardown_yield_fixture
    |     next(it)
    |   File "/app/tests/e2e/conftest.py", line 133, in ensure_clean_state
    |     cursor.execute("SET FOREIGN_KEY_CHECKS = 0")
    |   File "/usr/local/lib/python3.11/dist-packages/pymysql/cursors.py", line 153, in execute
    |     result = self._query(query)
    |              ^^^^^^^^^^^^^^^^^^
    |   File "/usr/local/lib/python3.11/dist-packages/pymysql/cursors.py", line 322, in _query
    |     conn.query(q)
    |   File "/usr/local/lib/python3.11/dist-packages/pymysql/connections.py", line 574, in query
    |     self._execute_command(COMMAND.COM_QUERY, sql)
    |   File "/usr/local/lib/python3.11/dist-packages/pymysql/connections.py", line 844, in _execute_command
    |     raise err.InterfaceError(0, "")
    | pymysql.err.InterfaceError: (0, '')
    +------------------------------------
=============================== warnings summary ===============================
tests/e2e/test_backup_restore.py: 15 warnings
  /usr/local/lib/python3.11/dist-packages/urllib3/connectionpool.py:1097: InsecureRequestWarning: Unverified HTTPS request is being made to host 'localhost'. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html#tls-warnings
    warnings.warn(

../../../usr/local/lib/python3.11/dist-packages/_pytest/cacheprovider.py:475
  /usr/local/lib/python3.11/dist-packages/_pytest/cacheprovider.py:475: PytestCacheWarning: cache could not write path /app/.pytest_cache/v/cache/nodeids: [Errno 30] Read-only file system: '/app/.pytest_cache/v/cache/nodeids'
    config.cache.set("cache/nodeids", sorted(self.cached_nodeids))

../../../usr/local/lib/python3.11/dist-packages/_pytest/cacheprovider.py:429
  /usr/local/lib/python3.11/dist-packages/_pytest/cacheprovider.py:429: PytestCacheWarning: cache could not write path /app/.pytest_cache/v/cache/lastfailed: [Errno 30] Read-only file system: '/app/.pytest_cache/v/cache/lastfailed'
    config.cache.set("cache/lastfailed", self.lastfailed)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
-------------- generated xml file: /tests/test-results/junit.xml ---------------
=========================== short test summary info ============================
ERROR test_backup_restore.py::TestFullBackupRestore::test_full_restore - Exce...
ERROR test_backup_restore.py::TestIncrementalBackupRestore::test_incremental_restore
ERROR test_backup_restore.py::TestRestorePreconditions::test_restore_requires_empty_data_directory
============= 10 passed, 17 warnings, 3 errors in 86.13s (0:01:26) =============
